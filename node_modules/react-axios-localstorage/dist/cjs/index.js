"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r=require("axios"),e=require("react");function t(r){return r&&"object"==typeof r&&"default"in r?r:{default:r}}var o=t(r);const a=(r,e,t)=>{if(!r)return;const o=`${t.prefix}_${r}`,a=((r,e,t)=>{const o=localStorage.getItem(r);if(o)try{const r=JSON.parse(o);if(!r)return;if(e&&r.invalidator!==e)return;if(r.invalidation<Date.now())return;if(t&&r.version!==t)return;return r}catch(e){return void console.error(`Invalid cache value for key ${r}`)}})(o,t?.invalidator,t?.version);if(a)return a[e];localStorage.removeItem(o)},i={bypass:!1,prefix:"ral",version:process.env.GITHUB_ACTIONS&&process.env.GITHUB_SHA,invalidationMS:3e5},n=(r,t,n,s)=>{const[l,c]=e.useState({data:void 0,error:void 0,loading:!0});return e.useEffect((()=>{const e=new URL(t),l=e.pathname,d=[];e.searchParams.forEach((r=>{d.push(r)}));const v={...i,...n,invalidator:[...d,n?.invalidator].join("_")},f=new AbortController,u=!v.bypass&&a(r,l,v);if(!u)return(async()=>{try{const e=await o.default.get(t,{...s,signal:f.signal});c({data:e.data,error:void 0,loading:!1}),!v.bypass&&((r,e,t,o)=>{if(!r)return;const a=`${o.prefix||"rx"}_${r}`;let i={invalidation:Date.now()+o.invalidationMS};o.invalidator&&(i.invalidator=o.invalidator),o.version&&(i.version=o.version),i[e]=t;const n=localStorage.getItem(a);if(n){const r=JSON.parse(n);r[e]=t,i={...i,...r}}localStorage.setItem(a,JSON.stringify(i))})(r,l,e.data,v)}catch(r){o.default.isAxiosError(r)?console.error(r.toJSON()):console.error({error:r}),c({data:void 0,error:r,loading:!1})}})(),()=>f.abort();c({data:u,error:void 0,loading:!1})}),[t]),l};exports.default=n,exports.defaultConfig=i,exports.invalidateCache=r=>{for(const e in localStorage)e.startsWith(r||i.prefix)&&localStorage.removeItem(e)},exports.useAxiosCache=n;
//# sourceMappingURL=index.js.map
